Added a check to ensure that no negative values appear in the outputs.
